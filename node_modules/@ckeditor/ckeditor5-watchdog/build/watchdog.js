/*!
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md.
 */(()=>{"use strict";var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{ContextWatchdog:()=>Fn,EditorWatchdog:()=>Dn,Watchdog:()=>r});class r{constructor(t){if(this.crashes=[],this.state="initializing",this._crashNumberLimit="number"==typeof t.crashNumberLimit?t.crashNumberLimit:3,this._now=Date.now,this._minimumNonErrorTimePeriod="number"==typeof t.minimumNonErrorTimePeriod?t.minimumNonErrorTimePeriod:5e3,this._boundErrorHandler=t=>{const e=t.error||t.reason;e instanceof Error&&this._handleError(e,t)},this._listeners={},!this._restart)throw new Error("The Watchdog class was split into the abstract `Watchdog` class and the `EditorWatchdog` class. Please, use `EditorWatchdog` if you have used the `Watchdog` class previously.")}setCreator(t){this._creator=t}setDestructor(t){this._destructor=t}destroy(){this._stopErrorHandling(),this._listeners={}}on(t,e){this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e)}off(t,e){this._listeners[t]=this._listeners[t].filter((t=>t!==e))}_fire(t,...e){const r=this._listeners[t]||[];for(const t of r)t.apply(this,[null,...e])}_startErrorHandling(){window.addEventListener("error",this._boundErrorHandler),window.addEventListener("unhandledrejection",this._boundErrorHandler)}_stopErrorHandling(){window.removeEventListener("error",this._boundErrorHandler),window.removeEventListener("unhandledrejection",this._boundErrorHandler)}_handleError(t,e){if(this._shouldReactToError(t)){this.crashes.push({message:t.message,stack:t.stack,filename:e.filename,lineno:e.lineno,colno:e.colno,date:this._now()});const r=this._shouldRestart();this.state="crashed",this._fire("stateChange"),this._fire("error",{error:t,causesRestart:r}),r?this._restart():(this.state="crashedPermanently",this._fire("stateChange"))}}_shouldReactToError(t){return t.is&&t.is("CKEditorError")&&void 0!==t.context&&null!==t.context&&"ready"===this.state&&this._isErrorComingFromThisItem(t)}_shouldRestart(){if(this.crashes.length<=this._crashNumberLimit)return!0;return(this.crashes[this.crashes.length-1].date-this.crashes[this.crashes.length-1-this._crashNumberLimit].date)/this._crashNumberLimit>this._minimumNonErrorTimePeriod}}const n=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)};const o="object"==typeof global&&global&&global.Object===Object&&global;var s="object"==typeof self&&self&&self.Object===Object&&self;const i=o||s||Function("return this")();const c=function(){return i.Date.now()};var a=/\s/;const u=function(t){for(var e=t.length;e--&&a.test(t.charAt(e)););return e};var h=/^\s+/;const l=function(t){return t?t.slice(0,u(t)+1).replace(h,""):t};const f=i.Symbol;var d=Object.prototype,_=d.hasOwnProperty,p=d.toString,y=f?f.toStringTag:void 0;const v=function(t){var e=_.call(t,y),r=t[y];try{t[y]=void 0;var n=!0}catch(t){}var o=p.call(t);return n&&(e?t[y]=r:delete t[y]),o};var b=Object.prototype.toString;const g=function(t){return b.call(t)};var m="[object Null]",j="[object Undefined]",w=f?f.toStringTag:void 0;const E=function(t){return null==t?void 0===t?j:m:w&&w in Object(t)?v(t):g(t)};const x=function(t){return null!=t&&"object"==typeof t};var O="[object Symbol]";const A=function(t){return"symbol"==typeof t||x(t)&&E(t)==O};var P=NaN,S=/^[-+]0x[0-9a-f]+$/i,C=/^0b[01]+$/i,T=/^0o[0-7]+$/i,I=parseInt;const z=function(t){if("number"==typeof t)return t;if(A(t))return P;if(n(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=n(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=l(t);var r=C.test(t);return r||T.test(t)?I(t.slice(2),r?2:8):S.test(t)?P:+t};var D="Expected a function",W=Math.max,F=Math.min;const M=function(t,e,r){var o,s,i,a,u,h,l=0,f=!1,d=!1,_=!0;if("function"!=typeof t)throw new TypeError(D);function p(e){var r=o,n=s;return o=s=void 0,l=e,a=t.apply(n,r)}function y(t){var r=t-h;return void 0===h||r>=e||r<0||d&&t-l>=i}function v(){var t=c();if(y(t))return b(t);u=setTimeout(v,function(t){var r=e-(t-h);return d?F(r,i-(t-l)):r}(t))}function b(t){return u=void 0,_&&o?p(t):(o=s=void 0,a)}function g(){var t=c(),r=y(t);if(o=arguments,s=this,h=t,r){if(void 0===u)return function(t){return l=t,u=setTimeout(v,e),f?p(t):a}(h);if(d)return clearTimeout(u),u=setTimeout(v,e),p(h)}return void 0===u&&(u=setTimeout(v,e)),a}return e=z(e)||0,n(r)&&(f=!!r.leading,i=(d="maxWait"in r)?W(z(r.maxWait)||0,e):i,_="trailing"in r?!!r.trailing:_),g.cancel=function(){void 0!==u&&clearTimeout(u),l=0,o=h=s=u=void 0},g.flush=function(){return void 0===u?a:b(c())},g};var N="Expected a function";const q=function(t,e,r){var o=!0,s=!0;if("function"!=typeof t)throw new TypeError(N);return n(r)&&(o="leading"in r?!!r.leading:o,s="trailing"in r?!!r.trailing:s),M(t,e,{leading:o,maxWait:e,trailing:s})};const U=function(){this.__data__=[],this.size=0};const R=function(t,e){return t===e||t!=t&&e!=e};const $=function(t,e){for(var r=t.length;r--;)if(R(t[r][0],e))return r;return-1};var k=Array.prototype.splice;const L=function(t){var e=this.__data__,r=$(e,t);return!(r<0)&&(r==e.length-1?e.pop():k.call(e,r,1),--this.size,!0)};const H=function(t){var e=this.__data__,r=$(e,t);return r<0?void 0:e[r][1]};const B=function(t){return $(this.__data__,t)>-1};const Q=function(t,e){var r=this.__data__,n=$(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};function V(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}V.prototype.clear=U,V.prototype.delete=L,V.prototype.get=H,V.prototype.has=B,V.prototype.set=Q;const K=V;const G=function(){this.__data__=new K,this.size=0};const Y=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r};const J=function(t){return this.__data__.get(t)};const X=function(t){return this.__data__.has(t)};var Z="[object AsyncFunction]",tt="[object Function]",et="[object GeneratorFunction]",rt="[object Proxy]";const nt=function(t){if(!n(t))return!1;var e=E(t);return e==tt||e==et||e==Z||e==rt};const ot=i["__core-js_shared__"];var st,it=(st=/[^.]+$/.exec(ot&&ot.keys&&ot.keys.IE_PROTO||""))?"Symbol(src)_1."+st:"";const ct=function(t){return!!it&&it in t};var at=Function.prototype.toString;const ut=function(t){if(null!=t){try{return at.call(t)}catch(t){}try{return t+""}catch(t){}}return""};var ht=/^\[object .+?Constructor\]$/,lt=Function.prototype,ft=Object.prototype,dt=lt.toString,_t=ft.hasOwnProperty,pt=RegExp("^"+dt.call(_t).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const yt=function(t){return!(!n(t)||ct(t))&&(nt(t)?pt:ht).test(ut(t))};const vt=function(t,e){return null==t?void 0:t[e]};const bt=function(t,e){var r=vt(t,e);return yt(r)?r:void 0};const gt=bt(i,"Map");const mt=bt(Object,"create");const jt=function(){this.__data__=mt?mt(null):{},this.size=0};const wt=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e};var Et="__lodash_hash_undefined__",xt=Object.prototype.hasOwnProperty;const Ot=function(t){var e=this.__data__;if(mt){var r=e[t];return r===Et?void 0:r}return xt.call(e,t)?e[t]:void 0};var At=Object.prototype.hasOwnProperty;const Pt=function(t){var e=this.__data__;return mt?void 0!==e[t]:At.call(e,t)};var St="__lodash_hash_undefined__";const Ct=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=mt&&void 0===e?St:e,this};function Tt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Tt.prototype.clear=jt,Tt.prototype.delete=wt,Tt.prototype.get=Ot,Tt.prototype.has=Pt,Tt.prototype.set=Ct;const It=Tt;const zt=function(){this.size=0,this.__data__={hash:new It,map:new(gt||K),string:new It}};const Dt=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};const Wt=function(t,e){var r=t.__data__;return Dt(e)?r["string"==typeof e?"string":"hash"]:r.map};const Ft=function(t){var e=Wt(this,t).delete(t);return this.size-=e?1:0,e};const Mt=function(t){return Wt(this,t).get(t)};const Nt=function(t){return Wt(this,t).has(t)};const qt=function(t,e){var r=Wt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};function Ut(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Ut.prototype.clear=zt,Ut.prototype.delete=Ft,Ut.prototype.get=Mt,Ut.prototype.has=Nt,Ut.prototype.set=qt;const Rt=Ut;var $t=200;const kt=function(t,e){var r=this.__data__;if(r instanceof K){var n=r.__data__;if(!gt||n.length<$t-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new Rt(n)}return r.set(t,e),this.size=r.size,this};function Lt(t){var e=this.__data__=new K(t);this.size=e.size}Lt.prototype.clear=G,Lt.prototype.delete=Y,Lt.prototype.get=J,Lt.prototype.has=X,Lt.prototype.set=kt;const Ht=Lt;const Bt=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););return t};const Qt=function(){try{var t=bt(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();const Vt=function(t,e,r){"__proto__"==e&&Qt?Qt(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r};var Kt=Object.prototype.hasOwnProperty;const Gt=function(t,e,r){var n=t[e];Kt.call(t,e)&&R(n,r)&&(void 0!==r||e in t)||Vt(t,e,r)};const Yt=function(t,e,r,n){var o=!r;r||(r={});for(var s=-1,i=e.length;++s<i;){var c=e[s],a=n?n(r[c],t[c],c,r,t):void 0;void 0===a&&(a=t[c]),o?Vt(r,c,a):Gt(r,c,a)}return r};const Jt=function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n};var Xt="[object Arguments]";const Zt=function(t){return x(t)&&E(t)==Xt};var te=Object.prototype,ee=te.hasOwnProperty,re=te.propertyIsEnumerable;const ne=Zt(function(){return arguments}())?Zt:function(t){return x(t)&&ee.call(t,"callee")&&!re.call(t,"callee")};const oe=Array.isArray;const se=function(){return!1};var ie="object"==typeof exports&&exports&&!exports.nodeType&&exports,ce=ie&&"object"==typeof module&&module&&!module.nodeType&&module,ae=ce&&ce.exports===ie?i.Buffer:void 0;const ue=(ae?ae.isBuffer:void 0)||se;var he=9007199254740991,le=/^(?:0|[1-9]\d*)$/;const fe=function(t,e){var r=typeof t;return!!(e=null==e?he:e)&&("number"==r||"symbol"!=r&&le.test(t))&&t>-1&&t%1==0&&t<e};var de=9007199254740991;const _e=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=de};var pe={};pe["[object Float32Array]"]=pe["[object Float64Array]"]=pe["[object Int8Array]"]=pe["[object Int16Array]"]=pe["[object Int32Array]"]=pe["[object Uint8Array]"]=pe["[object Uint8ClampedArray]"]=pe["[object Uint16Array]"]=pe["[object Uint32Array]"]=!0,pe["[object Arguments]"]=pe["[object Array]"]=pe["[object ArrayBuffer]"]=pe["[object Boolean]"]=pe["[object DataView]"]=pe["[object Date]"]=pe["[object Error]"]=pe["[object Function]"]=pe["[object Map]"]=pe["[object Number]"]=pe["[object Object]"]=pe["[object RegExp]"]=pe["[object Set]"]=pe["[object String]"]=pe["[object WeakMap]"]=!1;const ye=function(t){return x(t)&&_e(t.length)&&!!pe[E(t)]};const ve=function(t){return function(e){return t(e)}};var be="object"==typeof exports&&exports&&!exports.nodeType&&exports,ge=be&&"object"==typeof module&&module&&!module.nodeType&&module,me=ge&&ge.exports===be&&o.process;const je=function(){try{var t=ge&&ge.require&&ge.require("util").types;return t||me&&me.binding&&me.binding("util")}catch(t){}}();var we=je&&je.isTypedArray;const Ee=we?ve(we):ye;var xe=Object.prototype.hasOwnProperty;const Oe=function(t,e){var r=oe(t),n=!r&&ne(t),o=!r&&!n&&ue(t),s=!r&&!n&&!o&&Ee(t),i=r||n||o||s,c=i?Jt(t.length,String):[],a=c.length;for(var u in t)!e&&!xe.call(t,u)||i&&("length"==u||o&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||fe(u,a))||c.push(u);return c};var Ae=Object.prototype;const Pe=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Ae)};const Se=function(t,e){return function(r){return t(e(r))}};const Ce=Se(Object.keys,Object);var Te=Object.prototype.hasOwnProperty;const Ie=function(t){if(!Pe(t))return Ce(t);var e=[];for(var r in Object(t))Te.call(t,r)&&"constructor"!=r&&e.push(r);return e};const ze=function(t){return null!=t&&_e(t.length)&&!nt(t)};const De=function(t){return ze(t)?Oe(t):Ie(t)};const We=function(t,e){return t&&Yt(e,De(e),t)};const Fe=function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e};var Me=Object.prototype.hasOwnProperty;const Ne=function(t){if(!n(t))return Fe(t);var e=Pe(t),r=[];for(var o in t)("constructor"!=o||!e&&Me.call(t,o))&&r.push(o);return r};const qe=function(t){return ze(t)?Oe(t,!0):Ne(t)};const Ue=function(t,e){return t&&Yt(e,qe(e),t)};var Re="object"==typeof exports&&exports&&!exports.nodeType&&exports,$e=Re&&"object"==typeof module&&module&&!module.nodeType&&module,ke=$e&&$e.exports===Re?i.Buffer:void 0,Le=ke?ke.allocUnsafe:void 0;const He=function(t,e){if(e)return t.slice();var r=t.length,n=Le?Le(r):new t.constructor(r);return t.copy(n),n};const Be=function(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e};const Qe=function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,s=[];++r<n;){var i=t[r];e(i,r,t)&&(s[o++]=i)}return s};const Ve=function(){return[]};var Ke=Object.prototype.propertyIsEnumerable,Ge=Object.getOwnPropertySymbols;const Ye=Ge?function(t){return null==t?[]:(t=Object(t),Qe(Ge(t),(function(e){return Ke.call(t,e)})))}:Ve;const Je=function(t,e){return Yt(t,Ye(t),e)};const Xe=function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t};const Ze=Se(Object.getPrototypeOf,Object);const tr=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)Xe(e,Ye(t)),t=Ze(t);return e}:Ve;const er=function(t,e){return Yt(t,tr(t),e)};const rr=function(t,e,r){var n=e(t);return oe(t)?n:Xe(n,r(t))};const nr=function(t){return rr(t,De,Ye)};const or=function(t){return rr(t,qe,tr)};const sr=bt(i,"DataView");const ir=bt(i,"Promise");const cr=bt(i,"Set");const ar=bt(i,"WeakMap");var ur="[object Map]",hr="[object Promise]",lr="[object Set]",fr="[object WeakMap]",dr="[object DataView]",_r=ut(sr),pr=ut(gt),yr=ut(ir),vr=ut(cr),br=ut(ar),gr=E;(sr&&gr(new sr(new ArrayBuffer(1)))!=dr||gt&&gr(new gt)!=ur||ir&&gr(ir.resolve())!=hr||cr&&gr(new cr)!=lr||ar&&gr(new ar)!=fr)&&(gr=function(t){var e=E(t),r="[object Object]"==e?t.constructor:void 0,n=r?ut(r):"";if(n)switch(n){case _r:return dr;case pr:return ur;case yr:return hr;case vr:return lr;case br:return fr}return e});const mr=gr;var jr=Object.prototype.hasOwnProperty;const wr=function(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&jr.call(t,"index")&&(r.index=t.index,r.input=t.input),r};const Er=i.Uint8Array;const xr=function(t){var e=new t.constructor(t.byteLength);return new Er(e).set(new Er(t)),e};const Or=function(t,e){var r=e?xr(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)};var Ar=/\w*$/;const Pr=function(t){var e=new t.constructor(t.source,Ar.exec(t));return e.lastIndex=t.lastIndex,e};var Sr=f?f.prototype:void 0,Cr=Sr?Sr.valueOf:void 0;const Tr=function(t){return Cr?Object(Cr.call(t)):{}};const Ir=function(t,e){var r=e?xr(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)};var zr="[object Boolean]",Dr="[object Date]",Wr="[object Map]",Fr="[object Number]",Mr="[object RegExp]",Nr="[object Set]",qr="[object String]",Ur="[object Symbol]",Rr="[object ArrayBuffer]",$r="[object DataView]",kr="[object Float32Array]",Lr="[object Float64Array]",Hr="[object Int8Array]",Br="[object Int16Array]",Qr="[object Int32Array]",Vr="[object Uint8Array]",Kr="[object Uint8ClampedArray]",Gr="[object Uint16Array]",Yr="[object Uint32Array]";const Jr=function(t,e,r){var n=t.constructor;switch(e){case Rr:return xr(t);case zr:case Dr:return new n(+t);case $r:return Or(t,r);case kr:case Lr:case Hr:case Br:case Qr:case Vr:case Kr:case Gr:case Yr:return Ir(t,r);case Wr:return new n;case Fr:case qr:return new n(t);case Mr:return Pr(t);case Nr:return new n;case Ur:return Tr(t)}};var Xr=Object.create;const Zr=function(){function t(){}return function(e){if(!n(e))return{};if(Xr)return Xr(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}();const tn=function(t){return"function"!=typeof t.constructor||Pe(t)?{}:Zr(Ze(t))};var en="[object Map]";const rn=function(t){return x(t)&&mr(t)==en};var nn=je&&je.isMap;const on=nn?ve(nn):rn;var sn="[object Set]";const cn=function(t){return x(t)&&mr(t)==sn};var an=je&&je.isSet;const un=an?ve(an):cn;var hn=1,ln=2,fn=4,dn="[object Arguments]",_n="[object Function]",pn="[object GeneratorFunction]",yn="[object Object]",vn={};vn[dn]=vn["[object Array]"]=vn["[object ArrayBuffer]"]=vn["[object DataView]"]=vn["[object Boolean]"]=vn["[object Date]"]=vn["[object Float32Array]"]=vn["[object Float64Array]"]=vn["[object Int8Array]"]=vn["[object Int16Array]"]=vn["[object Int32Array]"]=vn["[object Map]"]=vn["[object Number]"]=vn[yn]=vn["[object RegExp]"]=vn["[object Set]"]=vn["[object String]"]=vn["[object Symbol]"]=vn["[object Uint8Array]"]=vn["[object Uint8ClampedArray]"]=vn["[object Uint16Array]"]=vn["[object Uint32Array]"]=!0,vn["[object Error]"]=vn[_n]=vn["[object WeakMap]"]=!1;const bn=function t(e,r,o,s,i,c){var a,u=r&hn,h=r&ln,l=r&fn;if(o&&(a=i?o(e,s,i,c):o(e)),void 0!==a)return a;if(!n(e))return e;var f=oe(e);if(f){if(a=wr(e),!u)return Be(e,a)}else{var d=mr(e),_=d==_n||d==pn;if(ue(e))return He(e,u);if(d==yn||d==dn||_&&!i){if(a=h||_?{}:tn(e),!u)return h?er(e,Ue(a,e)):Je(e,We(a,e))}else{if(!vn[d])return i?e:{};a=Jr(e,d,u)}}c||(c=new Ht);var p=c.get(e);if(p)return p;c.set(e,a),un(e)?e.forEach((function(n){a.add(t(n,r,o,n,e,c))})):on(e)&&e.forEach((function(n,s){a.set(s,t(n,r,o,s,e,c))}));var y=f?void 0:(l?h?or:nr:h?qe:De)(e);return Bt(y||e,(function(n,s){y&&(n=e[s=n]),Gt(a,s,t(n,r,o,s,e,c))})),a};var gn=1,mn=4;const jn=function(t,e){return bn(t,gn|mn,e="function"==typeof e?e:void 0)};var wn="[object Object]",En=Function.prototype,xn=Object.prototype,On=En.toString,An=xn.hasOwnProperty,Pn=On.call(Object);const Sn=function(t){if(!x(t)||E(t)!=wn)return!1;var e=Ze(t);if(null===e)return!0;var r=An.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&On.call(r)==Pn};const Cn=function(t){return x(t)&&1===t.nodeType&&!Sn(t)};function Tn(t,e=new Set){const r=[t],n=new Set;let o=0;for(;r.length>o;){const t=r[o++];if(!(n.has(t)||In(t)||e.has(t)))if(n.add(t),t[Symbol.iterator])try{for(const e of t)r.push(e)}catch(t){}else for(const e in t)"defaultValue"!==e&&r.push(t[e])}return n}function In(t){const e=Object.prototype.toString.call(t),r=typeof t;return"number"===r||"boolean"===r||"string"===r||"symbol"===r||"function"===r||"[object Date]"===e||"[object RegExp]"===e||"[object Module]"===e||null==t||!0===t._watchdogExcluded||t instanceof EventTarget||t instanceof Event}function zn(t,e,r=new Set){if(t===e&&("object"==typeof(n=t)&&null!==n))return!0;var n;const o=Tn(t,r),s=Tn(e,r);for(const t of o)if(s.has(t))return!0;return!1}class Dn extends r{constructor(t,e={}){super(e),this._editor=null,this._throttledSave=q(this._save.bind(this),"number"==typeof e.saveInterval?e.saveInterval:5e3),this._creator=(e,r)=>t.create(e,r),this._destructor=t=>t.destroy()}get editor(){return this._editor}get _item(){return this._editor}_restart(){return Promise.resolve().then((()=>(this.state="initializing",this._fire("stateChange"),this._destroy()))).catch((t=>{console.error("An error happened during the editor destroying.",t)})).then((()=>{if("string"==typeof this._elementOrData)return this.create(this._data,this._config,this._config.context);{const t=Object.assign({},this._config,{initialData:this._data});return this.create(this._elementOrData,t,t.context)}})).then((()=>{this._fire("restart")}))}create(t=this._elementOrData,e=this._config,r){return Promise.resolve().then((()=>(super._startErrorHandling(),this._elementOrData=t,this._config=this._cloneEditorConfiguration(e)||{},this._config.context=r,this._creator(t,this._config)))).then((t=>{this._editor=t,t.model.document.on("change:data",this._throttledSave),this._lastDocumentVersion=t.model.document.version,this._data=this._getData(),this.state="ready",this._fire("stateChange")}))}destroy(){return Promise.resolve().then((()=>(this.state="destroyed",this._fire("stateChange"),super.destroy(),this._destroy())))}_destroy(){return Promise.resolve().then((()=>{this._stopErrorHandling(),this._throttledSave.flush();const t=this._editor;return this._editor=null,t.model.document.off("change:data",this._throttledSave),this._destructor(t)}))}_save(){const t=this._editor.model.document.version;try{this._data=this._getData(),this._lastDocumentVersion=t}catch(t){console.error(t,"An error happened during restoring editor data. Editor will be restored from the previously saved data.")}}_setExcludedProperties(t){this._excludedProps=t}_getData(){const t={};for(const e of this._editor.model.document.getRootNames())t[e]=this._editor.data.get({rootName:e});return t}_isErrorComingFromThisItem(t){return zn(this._editor,t.context,this._excludedProps)}_cloneEditorConfiguration(t){return jn(t,((t,e)=>Cn(t)||"context"===e?t:void 0))}}const Wn=Symbol("MainQueueId");class Fn extends r{constructor(t,e={}){super(e),this._watchdogs=new Map,this._watchdogConfig=e,this._context=null,this._contextProps=new Set,this._actionQueues=new Mn,this._creator=e=>t.create(e),this._destructor=t=>t.destroy(),this._actionQueues.onEmpty((()=>{"initializing"===this.state&&(this.state="ready",this._fire("stateChange"))}))}get context(){return this._context}create(t={}){return this._actionQueues.enqueue(Wn,(()=>(this._contextConfig=t,this._create())))}getItem(t){return this._getWatchdog(t)._item}getItemState(t){return this._getWatchdog(t).state}add(t){const e=Nn(t);return Promise.all(e.map((t=>this._actionQueues.enqueue(t.id,(()=>{if("destroyed"===this.state)throw new Error("Cannot add items to destroyed watchdog.");if(!this._context)throw new Error("Context was not created yet. You should call the `ContextWatchdog#create()` method first.");let e;if(this._watchdogs.has(t.id))throw new Error(`Item with the given id is already added: '${t.id}'.`);if("editor"===t.type)return e=new Dn(this._watchdogConfig),e.setCreator(t.creator),e._setExcludedProperties(this._contextProps),t.destructor&&e.setDestructor(t.destructor),this._watchdogs.set(t.id,e),e.on("error",((r,{error:n,causesRestart:o})=>{this._fire("itemError",{itemId:t.id,error:n}),o&&this._actionQueues.enqueue(t.id,(()=>new Promise((r=>{e.on("restart",function n(){e.off("restart",n),this._fire("itemRestart",{itemId:t.id}),r()}.bind(this))}))))})),e.create(t.sourceElementOrData,t.config,this._context);throw new Error(`Not supported item type: '${t.type}'.`)})))))}remove(t){const e=Nn(t);return Promise.all(e.map((t=>this._actionQueues.enqueue(t,(()=>{const e=this._getWatchdog(t);return this._watchdogs.delete(t),e.destroy()})))))}destroy(){return this._actionQueues.enqueue(Wn,(()=>(this.state="destroyed",this._fire("stateChange"),super.destroy(),this._destroy())))}_restart(){return this._actionQueues.enqueue(Wn,(()=>(this.state="initializing",this._fire("stateChange"),this._destroy().catch((t=>{console.error("An error happened during destroying the context or items.",t)})).then((()=>this._create())).then((()=>this._fire("restart"))))))}_create(){return Promise.resolve().then((()=>(this._startErrorHandling(),this._creator(this._contextConfig)))).then((t=>(this._context=t,this._contextProps=Tn(this._context),Promise.all(Array.from(this._watchdogs.values()).map((t=>(t._setExcludedProperties(this._contextProps),t.create(void 0,void 0,this._context))))))))}_destroy(){return Promise.resolve().then((()=>{this._stopErrorHandling();const t=this._context;return this._context=null,this._contextProps=new Set,Promise.all(Array.from(this._watchdogs.values()).map((t=>t.destroy()))).then((()=>this._destructor(t)))}))}_getWatchdog(t){const e=this._watchdogs.get(t);if(!e)throw new Error(`Item with the given id was not registered: ${t}.`);return e}_isErrorComingFromThisItem(t){for(const e of this._watchdogs.values())if(e._isErrorComingFromThisItem(t))return!1;return zn(this._context,t.context)}}class Mn{constructor(){this._onEmptyCallbacks=[],this._queues=new Map,this._actions=new WeakMap,this._lastActionId=0,this._activeActions=0}onEmpty(t){this._onEmptyCallbacks.push(t)}enqueue(t,e){const r=t===Wn;this._activeActions++,this._queues.get(t)||this._queues.set(t,Promise.resolve());const n=(r?Promise.all(this._queues.values()):Promise.all([this._queues.get(Wn),this._queues.get(t)])).then(e),o=n.catch((()=>{}));return this._queues.set(t,o),n.finally((()=>{this._activeActions--,this._queues.get(t)===o&&0===this._activeActions&&this._onEmptyCallbacks.forEach((t=>t()))}))}}function Nn(t){return Array.isArray(t)?t:[t]}(window.CKEditor5=window.CKEditor5||{}).watchdog=e})();